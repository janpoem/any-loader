{"version":3,"file":"any-loader.without-bluebird.umd.js","sources":["../node_modules/deepmerge/dist/es.js","../src/Loader.mjs"],"sourcesContent":["var isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tObject.keys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tObject.keys(source).forEach(function(key) {\n\t\tif (!options.isMergeableObject(source[key]) || !target[key]) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = deepmerge(target[key], source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nexport default deepmerge_1;\n","'use strict';\r\n\r\nconst toString = Object.prototype.toString;\r\nconst isArray = Array.isArray;\r\n\r\nimport BluebirdPromise from 'bluebird';\r\nimport merge from 'deepmerge';\r\n\r\nconst callbackAsPromise = (callback, binder, args, resolve, reject) => {\r\n\tif (typeof callback === 'function') {\r\n\t\t// 过滤binder\r\n\t\tif (typeof binder !== 'object') binder = null;\r\n\t\t// 过滤args\r\n\t\tif (typeof args === 'undefined') args = [];\r\n\t\telse if (!isArray(args)) args = [args];\r\n\t\t\r\n\t\ttry {\r\n\t\t\treturn callbackAsPromise(callback.apply(binder, args), binder, args);\r\n\t\t} catch (err) {\r\n\t\t\treturn BluebirdPromise.reject(err);\r\n\t\t}\r\n\t}\r\n\telse if (callback instanceof Error) {\r\n\t\treturn BluebirdPromise.reject(callback);\r\n\t}\r\n\telse if (isArray(callback) && callback.length > 0 && typeof resolve === 'function' && typeof reject ===\r\n\t         'function') {\r\n\t\tconst item = callback.shift();\r\n\t\treturn callbackAsPromise(item, binder, args).then(() => {\r\n\t\t\tif (callback.length > 0) {\r\n\t\t\t\tcallbackAsPromise(callback, binder, args, resolve, reject);\r\n\t\t\t} else {\r\n\t\t\t\tresolve();\r\n\t\t\t}\r\n\t\t}).catch(reject);\r\n\t}\r\n\t// else if (callback instanceof Promise) {\r\n\t// \t// return new Promise((resolve, reject) => {\r\n\t// \t// \tcallback.then(() => {\r\n\t// \t// \t\tresolve();\r\n\t// \t// \t}).catch(err => {\r\n\t// \t// \t\treject(err);\r\n\t// \t// \t});\r\n\t// \t// });\r\n\t// \t// return new bbPromise(callback); // 这里必须强制转换为 bluebird 的 Promise\r\n\t// \treturn bbPromise.resolve(callback);\r\n\t// }\r\n\telse if (callback instanceof BluebirdPromise) {\r\n\t\treturn callback;\r\n\t} else {\r\n\t\treturn BluebirdPromise.resolve(callback);\r\n\t}\r\n};\r\n\r\n// lodash.isString\r\nconst isString = (value) => {\r\n\tconst type = typeof value;\r\n\treturn type === 'string' ||\r\n\t       (type === 'object' && value != null && !isArray(value) && toString.call(value) === '[object String]');\r\n};\r\n\r\n\r\nclass LoadStreamError extends Error {\r\n\t\r\n\tconstructor(error, process, stream) {\r\n\t\tsuper();\r\n\t\tthis.error = null;\r\n\t\tthis.process = '';\r\n\t\tthis.stream = null;\r\n\t\t// oh my god....\r\n\t\tObject.defineProperties(this, {\r\n\t\t\tname   : {\r\n\t\t\t\tvalue       : 'LoadStreamError',\r\n\t\t\t\twritable    : false,\r\n\t\t\t\tenumerable  : true,\r\n\t\t\t\tconfigurable: false\r\n\t\t\t},\r\n\t\t\terror  : {\r\n\t\t\t\tvalue       : error,\r\n\t\t\t\twritable    : false,\r\n\t\t\t\tenumerable  : true,\r\n\t\t\t\tconfigurable: false\r\n\t\t\t},\r\n\t\t\tprocess: {\r\n\t\t\t\tvalue       : process,\r\n\t\t\t\twritable    : false,\r\n\t\t\t\tenumerable  : true,\r\n\t\t\t\tconfigurable: false\r\n\t\t\t},\r\n\t\t\tstream : {\r\n\t\t\t\tvalue       : stream,\r\n\t\t\t\twritable    : false,\r\n\t\t\t\tenumerable  : true,\r\n\t\t\t\tconfigurable: false\r\n\t\t\t},\r\n\t\t\tmessage: {\r\n\t\t\t\tget: () => {\r\n\t\t\t\t\treturn this.getMessage();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n\tgetMessage() {\r\n\t\tif (this.error instanceof Error || (this.error.message && isString(this.error.message)))\r\n\t\t\treturn this.error.message;\r\n\t\telse if (isString(this.error))\r\n\t\t\treturn this.error;\r\n\t\telse\r\n\t\t\treturn this.error + '';\r\n\t}\r\n}\r\n\r\nconst ProcessSetup = 'setup';\r\nconst ProcessBefore = 'before';\r\nconst ProcessDoing = 'doing';\r\nconst ProcessAfter = 'after';\r\n\r\n/**\r\n * 数据库加载器的抽象类\r\n *\r\n * - 考虑到精简核心类的代码，以及面向AOP、OOP编程特性的实现，不考虑实现面向事件的实现了。实际上这不是 `Loader` 这个层面要去解决的问题，完全可以在子类中自行实现。\r\n *\r\n * @type Loader\r\n * @property {{}} args\r\n */\r\nclass Loader {\r\n\t\r\n\t/**\r\n\t * 构建函数\r\n\t *\r\n\t * @param {*} args 调用 loader 的初始化参数\r\n\t */\r\n\tconstructor(args = undefined) {\r\n\t\tObject.defineProperties(this, {\r\n\t\t\targs: {\r\n\t\t\t\tvalue       : this.initArgs(args),\r\n\t\t\t\twritable    : false,\r\n\t\t\t\tenumerable  : true,\r\n\t\t\t\tconfigurable: false\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * 是否一个普通的 object 对象\r\n\t *\r\n\t * - 如果是 `function`（函数），则执行并取回其结果（这里忽略异步模式）\r\n\t * - 必须是 `object` 类型，且不能为 `null`\r\n\t * - 不能是数组\r\n\t * - 不允许是原生 `Promise` 或 `bluebird.Promise`\r\n\t *\r\n\t * @param {*} value\r\n\t * @return {boolean}\r\n\t */\r\n\tisPlainObject(value) {\r\n\t\t// return !(typeof value !== 'object' || value === null || isArray(value) ||\r\n\t\t// \tvalue instanceof Promise || value instanceof OrigPromise);\r\n\t\treturn !(typeof value !== 'object' || value === null || isArray(value) ||\r\n\t\t         value instanceof Promise || value instanceof BluebirdPromise);\r\n\t}\r\n\t\r\n\t/**\r\n\t * 基于 value ，返回有效的普通 object 或 defaultObj\r\n\t *\r\n\t * @param {*} value\r\n\t * @param {{}} defaultObj\r\n\t * @return {{}}\r\n\t */\r\n\tgetPlainObject(value, defaultObj = {}) {\r\n\t\tif (typeof value === 'function') value = value();\r\n\t\treturn this.isPlainObject(value) ? value : (this.isPlainObject(defaultObj) ? defaultObj : {});\r\n\t}\r\n\t\r\n\t/**\r\n\t * 检查一个参数是否为有效的 Loader 构造参数，默认使用的是 `isPlainObject` 的结果，用于提供给后继的类重载该方法\r\n\t *\r\n\t * @param {*} args\r\n\t * @return {boolean}\r\n\t */\r\n\tisValidArgs(args) {\r\n\t\treturn this.isPlainObject(args);\r\n\t}\r\n\t\r\n\tgetValidArgs(args, defaultArgs = this.getDefaultArgs()) {\r\n\t\tif (typeof args === 'function') args = args();\r\n\t\treturn this.isValidArgs(args) ? args : (this.isValidArgs(defaultArgs) ? defaultArgs : {});\r\n\t}\r\n\t\r\n\tgetDefaultArgs() {\r\n\t\treturn {};\r\n\t}\r\n\t\r\n\t/**\r\n\t * 初始化传入的 args\r\n\t *\r\n\t * @param {*} args 传入的参数\r\n\t * @param {*|undefined|null} mergeArgs 需要合并的参数\r\n\t * @returns {{}}\r\n\t */\r\n\tinitArgs(args, mergeArgs = undefined) {\r\n\t\targs = this.getValidArgs(args);\r\n\t\t// 被合并后的对象，是一个全新的对象\r\n\t\tif (typeof mergeArgs !== 'undefined' || mergeArgs !== null) {\r\n\t\t\targs = merge(args, this.getValidArgs(mergeArgs));\r\n\t\t}\r\n\t\treturn args;\r\n\t}\r\n\t\r\n\tmergeArgs(args) {\r\n\t\treturn merge(this.args, this.getValidArgs(args));\r\n\t}\r\n\t\r\n\t/**\r\n\t * 生成新的 LoadStream 输入（input）\r\n\t *\r\n\t * 应该确保该函数返回的，是一个纯粹的 `object`\r\n\t *\r\n\t * @param {*} input\r\n\t * @return {{}}\r\n\t */\r\n\tnewInput(input) {\r\n\t\treturn this.mergeArgs(input);\r\n\t}\r\n\t\r\n\t/**\r\n\t * 生成新的 LoadStream 输出（output）\r\n\t *\r\n\t * @param {{}} input\r\n\t * @param {{}|undefined} output\r\n\t * @return {*}\r\n\t */\r\n\tnewOutput(input, output = undefined) {\r\n\t\treturn this.getPlainObject(output);\r\n\t}\r\n\t\r\n\t/**\r\n\t * 判断是否抛出特定的异常（基于 process 和 error 的类型判断），`Loader` 默认的行为以 process 来进行判断\r\n\t *\r\n\t * @param error\r\n\t * @param process\r\n\t * @return {boolean}\r\n\t */\r\n\tisThrowError(error, process) {\r\n\t\tswitch (process) {\r\n\t\t\tcase ProcessAfter :\r\n\t\t\tcase ProcessDoing :\r\n\t\t\tcase ProcessBefore:\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * 错误异常的处理方式\r\n\t *\r\n\t * 被 throw 或 reject 的异常，不需要再返回，只返回未被接管的异常，转交给下一个流程进行处理\r\n\t *\r\n\t * @param {*} error\r\n\t * @param {string} process\r\n\t * @param {{}} stream\r\n\t * @param {function|null|undefined} reject\r\n\t * @returns {this}\r\n\t */\r\n\thandleError(error, process, stream = {}, reject = undefined) {\r\n\t\t\r\n\t\t// 过滤一下 error ，确使每个 error 都是 Error 实例\r\n\t\tif (!(error instanceof LoadStreamError))\r\n\t\t\terror = new LoadStreamError(error, process, stream);\r\n\t\t\r\n\t\tif (!isArray(stream.errors)) stream.errors = [];\r\n\t\tstream.errors.push(error); // 不管三七二十一，错误都放入堆\r\n\t\tstream.error = error; // 绑定当前的错误\r\n\t\t\r\n\t\tif (this.isThrowError(error, process)) {\r\n\t\t\tif (typeof reject === 'function') {\r\n\t\t\t\treject(error);\r\n\t\t\t} else {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * 生成一个新的 LoadStream\r\n\t *\r\n\t * `LoadStream` —— 本质上是一个不可逆转的数据流向，所以必然具备明确的 `input` 和 `output`。\r\n\t *\r\n\t * 从实际编程角度出发，我们并不会真的构造一个 `LoadStream` 类，而是用一个 `Promise` 来表达数据加载流向。\r\n\t *\r\n\t * 另一方面，尽量使用面向 fn 编程，即 `LoadStream` 的实体只在数据流向的接口中有效，`Loader` 不应该是一个状态持有者（`Loader`无状态）\r\n\t *\r\n\t * 一般而言，这个方法除了在单元测试中使用，很少直接在实际业务层面去调用这个方法。\r\n\t *\r\n\t * 该方法包含了 `Promise` 的实现，所以尽量不应该在继承的子类中被重载（可惜JS没有保护或者final，也没有私有定义）\r\n\t *\r\n\t * @final\r\n\t * @param {{}|undefined} input\r\n\t * @param {{}|undefined} output\r\n\t */\r\n\tnewLoadStream(input = undefined, output = undefined) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tinput = this.newInput(input);\r\n\t\t\toutput = this.newOutput(input, output);\r\n\t\t\tconst stream = {input, output, errors: [], error: null}; // 增加一个当前的错误\r\n\t\t\tcallbackAsPromise(this.setup, this, [stream])\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tresolve(stream);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(error => {\r\n\t\t\t\t\tthis.handleError(error, ProcessSetup, stream, reject);\r\n\t\t\t\t\tresolve(stream);\r\n\t\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * `LoadStream` 的安装接口，每次执行 `load` 都会生成一个新的 `LoadStream`，然后执行一次 `setup` 接口\r\n\t *\r\n\t * `setup` 过程中抛出的任何错误，默认的 `Loader` 行为是不会将其抛出，或者 reject 的，而是会作为静默的模式往下一个数据流的接口前进。\r\n\t *\r\n\t * 在接口中使用异步（包括 beforeLoad/doLoad/afterLoad）说明：\r\n\t *\r\n\t * - `setup` 允许调用异步方法（比如异步打开文件，异步请求服务器令牌之类），使用异步，必须确保这个接口 `return new Promise()` ，\r\n\t *   以使得其能和后面的数据流接口对接（包括兼容 async/await）。\r\n\t * - 使用 `Promise` 时，必须明确执行 `resolve` 或 `reject` （特别是逻辑上，最低限度必须有其中一者被执行到，特别要注意，有些地方 if\r\n\t *   过去了，实际上未执行。），因为 `Promise` 设计上，就必须有明确的结果（`resolve` 或 `reject`），否则将会使 `Promise` 看似跳空\r\n\t *   未执行，实际上这个 `Promise` 一直被挂起了，等待结束。\r\n\t * - 如果 `Promise` 中，还存在另一个异步（比如setTimeout，他实际上并不是和 `Promise` 在一个层面的线程管理中 —— 某程度可以这么理解），\r\n\t *   这时候，尤其是在 node.js 环境下，就会出现写入对象属性丢失的问题，这实际上就是 C# Java 常说的线程安全问题，所以，在 `Promise`\r\n\t *   必须严格使用 `resolve` 和 `reject` ，仅且应该只使用这两个方式，来传递数据或者对象（这比上述一点的要求更进一步，更严格了）。\r\n\t * - 所以，总结而言，在 `Promise` 中，抛出异常应该尽量使用 `resolve` 或 `reject`，特别是在异步中再执行异步时，问题将变得更加复杂。\r\n\t *\r\n\t * @param {{input: {}, output: {}, errors: array}} loadStream\r\n\t */\r\n\tsetup(loadStream) {\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * ·load· 的前置接口\r\n\t *\r\n\t * load 方法被执行后，依次调用 `newLoadStream -> setup -> beforeLoad -> doLoad -> afterLoad` 几个接口。\r\n\t *\r\n\t * 其中 `newLoadStream` 和 `setup` 默认不会干涉异常，采用静默模式。后三者，任意一个环节存在异常错误，则会中断后续的接口执行。\r\n\t *\r\n\t * ```\r\n\t * `beforeLoad`  ->  `doLoad`  ->  `afterLoad`\r\n\t *       \\              \\               \\\r\n\t *     Error          Error           Error\r\n\t * ```\r\n\t *\r\n\t * 在接口中未执行异步调用（异步中的异步），可直接使用 `throw new Error` 来抛出异常，简化代码，减少结构控制的代码量。\r\n\t *\r\n\t * @param {{input: {}, output: {}, errors: array}} loadStream\r\n\t */\r\n\tbeforeLoad(loadStream) {\r\n\t}\r\n\t\r\n\t/**\r\n\t * `load` 实际执行的实现接口， Loader 作为父类，默认会抛出异常，请在继承的子类中扩展。\r\n\t *\r\n\t * 请参考 `setup` 和 `beforeLoad` 的注释说明\r\n\t *\r\n\t * @param {{input: {}, output: {}, errors: array}} loadStream\r\n\t */\r\n\tdoLoad(loadStream) {\r\n\t\tthrow new Error(`Loader.doLoad is an abstract method, please overload in ${this.constructor.name}!`);\r\n\t}\r\n\t\r\n\t/**\r\n\t * `load` 的后置接口\r\n\t *\r\n\t * @param {{input: {}, output: {}, errors: array}} loadStream\r\n\t */\r\n\tafterLoad(loadStream) {\r\n\t}\r\n\t\r\n\tload(input = undefined) {\r\n\t\treturn new BluebirdPromise((resolve, reject) => {\r\n\t\t\treturn this.newLoadStream(input).then(loadStream => {\r\n\t\t\t\tlet process = ProcessBefore;\r\n\t\t\t\tconst onCatch = (err) => {\r\n\t\t\t\t\tthis.handleError(err, process, loadStream, reject);\r\n\t\t\t\t\tresolve(loadStream);\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\treturn callbackAsPromise(this.beforeLoad, this, [loadStream]).then((/* ignore here */) => {\r\n\t\t\t\t\tprocess = ProcessDoing;\r\n\t\t\t\t\treturn callbackAsPromise(this.doLoad, this, [loadStream]).then((/* ignore here */) => {\r\n\t\t\t\t\t\tprocess = ProcessAfter;\r\n\t\t\t\t\t\treturn callbackAsPromise(this.afterLoad, this, [loadStream]).then((/* ignore here */) => {\r\n\t\t\t\t\t\t\tresolve(loadStream);\r\n\t\t\t\t\t\t}).catch(onCatch);\r\n\t\t\t\t\t}).catch(onCatch);\r\n\t\t\t\t}).catch(onCatch);\r\n\t\t\t}).catch(err => {\r\n\t\t\t\treject(err);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default Loader;"],"names":["REACT_ELEMENT_TYPE","toString","Object","prototype","isArray","Array","callbackAsPromise","callback","binder","args","resolve","reject","apply","err","BluebirdPromise","Error","length","item","shift","then","catch","isString","value","type","call","LoadStreamError","error","process","stream","defineProperties","name","writable","enumerable","configurable","message","get","getMessage","ProcessSetup","ProcessBefore","ProcessDoing","ProcessAfter","Loader","undefined","initArgs","Promise","defaultObj","isPlainObject","defaultArgs","getDefaultArgs","isValidArgs","mergeArgs","getValidArgs","merge","input","output","getPlainObject","errors","push","isThrowError","newInput","newOutput","setup","handleError","loadStream","constructor","newLoadStream","onCatch","beforeLoad","doLoad","afterLoad"],"mappings":"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"}